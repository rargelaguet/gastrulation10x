---
title: "Gastrulation 10x: gene set enrichment analysis"
output: 
  BiocStyle::html_document: 
    fig_width: 10
    fig_height: 8
---

Load MsigDb gene set
```{r go_enrichment, echo=FALSE}
# I/O MSigDB
io$msigFile <- "/Users/ricard/data/MSigDB/v6.0/mus_musculus/C5/bp_binary_matrix_ensembl.rds"
# io$msigFile <- "/Users/ricard/data/MSigDB/v6.0/mus_musculus/C2/binary_matrix_ensembl.rds"

# Load MSigDB files
gene.sets <- readRDS(io$msigFile)
```

```{r}
model.go <- model
```

```{r}
features(model.go)[["RNA"]] <- toupper(features(model.go)[["RNA"]])
```

```{r}
enrichment.out <- run_enrichment(model.go,
  view = "RNA",
  feature.sets = gene.sets,
  statistical.test = "parametric",
  alpha = 0.01
)
```

```{r}
View(enrichment.out$pval.adj)
```

```{r}
p <- plot_enrichment(enrichment.out, factor=6, max.pathways = 15)

pdf(paste0(io$pdfdir,"/Factor6_enrichment.pdf"), width=10, height=4, useDingbats = F)
print(p)
dev.off()
```


