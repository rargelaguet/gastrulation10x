---
title: "Gastrulation: plot expression of individual genes"
---
  
```{r echo=FALSE, include=FALSE}
library(SingleCellExperiment)
```

```{r funcs, echo=FALSE}
# source("/Users/ricard/gastrulation/rna/differential/utils.R")
# boxplot_theme <- function() {
#   p <- theme(
#     plot.title = element_text(size=rel(1.2), hjust=0.5),
#     axis.title = element_text(colour="black", size=rel(1.2)),
#     axis.text.x = element_text(colour="black",size=rel(1.0), angle=10, hjust=1),
#     # axis.text.x = element_text(colour="black",size=rel(1.0)),
#     axis.text.y = element_text(colour="black",size=rel(1.1)),
#     axis.line = element_line(colour="black", size=rel(0.9)),
#     panel.background = element_blank(),
#     panel.grid = element_blank(),
#     legend.position="none",
#     legend.text=element_text(size=15),
#     legend.title=element_blank(),
#     legend.background=element_blank(),
#     panel.border = element_blank()
#   )
# }
```

```{r define_opts, echo=FALSE, include=FALSE}
source("/Users/ricard/gastrulation10x/settings.R")
io$outdir <- paste0(io$basedir,"/individual_genes")

## Define options

# Define stages to plot
# Define cell types to plot

```

Update sample metadata
```{r }

```

<!-- Load expression data -->
```{r load_expr, echo=FALSE, include=FALSE}
# Load SingleCellExperiment object
sce <- readRDS(io$rna.sce)[,sample_metadata$cell]

# Create data.table
rna <- exprs(sce) %>% t %>% as.data.table(keep.rownames="id_rna") %>% melt(id.vars="id_rna", value.name="expr", variable.name="id") %>%
  merge(rowData(sce) %>% as.data.frame(row.names=rownames(sce)) %>% tibble::rownames_to_column("ens_id") %>% .[,c("symbol","ens_id")] %>% as.data.table %>% setnames("ens_id","id"))
```

<!-- Merge data and metadata -->
```{r}
rna <- merge(rna, sample_metadata[,c("id_rna","stage_lineage","stage")], by="id_rna")
```

<!-- Boxplots of mean differences from manual hits -->
```{r}
gene_id <- "Dnmt3l"

to.plot <- rna[symbol==gene_id] %>% 
  .[,stage_lineage:=factor(stage_lineage, levels=opts$stage_lineage)]

p <- ggplot(to.plot, aes(x=stage_lineage, y=expr)) +
  geom_jitter(size=0.8, color="#3CB54E") +
  # geom_point(aes(color=stage), size=1.0) +
  geom_violin(fill="#3CB54E", alpha=0.6) +
  geom_boxplot(fill="#3CB54E", alpha=0.4, width=0.3) +
  # stat_summary(aes(fill=stage_lineage), fun.data=MinMeanSEMMax, geom="boxplot") + 
  # coord_cartesian(ylim=c(0,9)) +
  boxplot_theme() +
  labs(title=gene_id, x="",y="RNA expression")
print(p)

# pdf(paste0(io$outdir,"/rna_",gene_id,".pdf"), width=8, height=5, useDingbats = F)
# print(p)
# dev.off()
```
  